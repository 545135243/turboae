__author__ = 'yihanjiang'
'''
yihan@ubuntuserver16:~/NeurIPS_DTA_package/commpy$ python turbo_codes_benchmark.py -noise_type fading -enc1 7 -enc2 5 -feedback 7 -M 2 -num_block 100 -num_cpu 10 -snr_test_start -1.5 -snr_test_end 4.0 -snr_points 12  -num_block 100000 -num_cpu 20

'''

# CodingSchemes = {'Uncoded', 'LDPC', 'Turbo',  'Polar','TBC'};
Uncoded = [0.221739000000000,	0.210202000000000,	0.198819000000000,	0.188005000000000,	0.177020000000000,	0.166002000000000	,0.156391000000000	,0.145955000000000,	0.135745000000000,	0.126069000000000,	0.116725000000000,	0.107072000000000]
ldpc    = [0.239511000000000,	0.205165000000000,	0.167563000000000	,0.122133000000000,	0.0804430000000000	,0.0440720000000000,	0.0204330000000000,	0.00831000000000000,	0.00306100000000000,	0.000878000000000000,	0.000324000000000000,	7.40000000000000e-05]
turbo   = [0.191246590909091,	0.161477272727273	,0.123978409090909,	0.0851534090909091,
           0.0496500000000000,	0.0250000000000000,	0.0100568181818182,	0.00304204545454546,
           0.00102954545454545,	0.000120454545454545,	2.50000000000000e-05,	0]
Polar   = [0.352382000000000	,0.308573000000000	,0.260782000000000	,0.221208000000000	,0.183950000000000	,0.159502000000000,	0.143634000000000,	0.134360000000000,	0.128573000000000,	0.124830000000000,	0.123445000000000,	0.122168000000000]
tbc = [0.309815000000000,	0.257678000000000,	0.198012000000000,	0.141993000000000,	0.0937140000000001,	0.0572070000000000,	0.0313120000000000,	0.0153850000000000,	0.00751700000000000,	0.00370200000000000,	0.00145200000000000	,0.000709000000000000]


snr =  [-1.5, -1.0, -0.5, 0.0, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0]
# old GRU models
dta_q2_awgntrained_gru_gru_rayleigh_ber = [0.19240228831768036, 0.13351580500602722, 0.08192481100559235, 0.04215489700436592, 0.018722202628850937, 0.006905898451805115, 0.0023763994686305523, 0.0007559999939985573, 0.00030749995494261384, 0.00013599998783320189, 6.280000525293872e-05, 3.0999995942693204e-05]
dta_q2_awgntrained_gru_gru_rayleigh_bler =[0.9145600000000005, 0.8044500000000003, 0.6394900000000002, 0.44458000000000014, 0.26818000000000014, 0.14290999999999995, 0.07104000000000002, 0.034399999999999986, 0.017519999999999984, 0.009220000000000006, 0.004600000000000003, 0.0023800000000000015]


dta_q2_fadingtrained_gru_gru_rayleigh_ber =[0.18129962682724, 0.12476291507482529, 0.07590407878160477, 0.039480291306972504, 0.017069293186068535, 0.006754598580300808, 0.0022746995091438293, 0.0007920998614281416, 0.0003083999617956579, 0.00012700002116616815, 6.530000973725691e-05, 2.919999315054156e-05]
dta_q2_fadingtrained_gru_gru_rayleigh_bler = [0.8938000000000008, 0.77633, 0.6087999999999998, 0.41633999999999993, 0.24950000000000006, 0.13560000000000008, 0.06863000000000001, 0.033829999999999985, 0.01716999999999999, 0.008640000000000007, 0.004800000000000003, 0.0022100000000000015]


# new CNN models
dta_cont_awgntrained_cnn2cnn5_ber = [0.18660251796245575, 0.12673698365688324, 0.07516038417816162, 0.03763650730252266, 0.015840599313378334, 0.005864499602466822, 0.0020872997120022774, 0.0007807998917996883, 0.0003263999824412167, 0.00016219996905419976, 7.419999747071415e-05, 3.97000003431458e-05]
dta_cont_awgntrained_cnn2cnn5_bler = [0.9010300000000006, 0.7850100000000007, 0.6146, 0.4200699999999999, 0.25207, 0.13748000000000002, 0.07139000000000004, 0.03648999999999998, 0.01900999999999999, 0.010550000000000004, 0.005140000000000003, 0.0028100000000000017]

dta_binary_awgntrained_cnn2cnn5_ber = []


dta_binary_awgntrained_cnn2cnn5_ber =[0.17493386566638947, 0.12080370634794235, 0.0726282000541687, 0.03875389322638512,
                                      0.01742340251803398, 0.006800799630582333, 0.00253169983625412, 0.0009854999370872974, 0.00043089993414469063, 0.00018440000712871552, 9.709998994367197e-05, 4.7199999244185165e-05]
dta_binary_awgntrained_cnn2cnn5_bler = [0.8954500000000003, 0.7841900000000007, 0.62035, 0.44171000000000016, 0.27558000000000005, 0.15444999999999998, 0.08368000000000002, 0.04481000000000001, 0.025279999999999973, 0.012799999999999994, 0.007150000000000005, 0.0035000000000000027]


turbo757_awgn_rayleigh_fading_ber =  [0.2270908, 0.2031393, 0.1754928, 0.1414874,
                                      0.105442, 0.0706487, 0.0412599, 0.0205164, 0.0087888, 0.0032453, 0.0011646, 0.0004097]
turbo757_awgn_rayleigh_fading_bler = [0.9981, 0.98833, 0.96007, 0.8882099999999999, 0.75963, 0.58238, 0.38953000000000004, 0.22797999999999996, 0.11548999999999998, 0.05454999999999999, 0.024989999999999957, 0.011880000000000002]

turboLTE_awgn_rayleigh_fading_ber =[0.235892, 0.213806, 0.187677, 0.154148,
                                    0.1171, 0.079404, 0.046886, 0.02199, 0.009492, 0.00303, 0.000847, 0.000217]
turboLTE_awgn_rayleigh_fading_bler = [0.9972, 0.9883, 0.9568, 0.8734999999999999, 0.7325999999999999, 0.5458000000000001, 0.35329999999999995, 0.1866, 0.08979999999999999, 0.035499999999999976, 0.01539999999999997, 0.00660000000000005]

'''
CUDA_VISIBLE_DEVICES=3 python3.6 main.py  -encoder dta_rate3_cnn -decoder dta_rate3_cnn  -enc_num_unit 100 -dec_num_unit 100 -num_iter_ft 5 -channel awgn -num_train_dec 5 -num_train_enc 1 -code_rate_k 1 -code_rate_n 3 -group_norm_g 1 -train_channel_low 2.0 -train_channel_high 2.0  -snr_test_start -1.5 -snr_test_end 4.0 -snr_points 12 -num_iteration 6  -is_parallel 1  -train_dec_channel_low -1.5 -train_dec_channel_high 2.0  -group_norm_g 1 -is_same_interleaver 1 -num_train_enc 1  -num_train_dec 5 -dec_lr 0.00001 -enc_lr 0.00001  -num_block 50000 -batch_size 500 -train_channel_mode group_norm_quantize -test_channel_mode group_norm_quantize -enc_quantize_level 2 -enc_value_limit 1.0 -enc_clipping both -enc_grad_limit 0.00001 -enc_num_layer 2 -dec_num_layer 5 -init_nw_weight  ./models/dta_cnn_q2_enccnn2_deccnn5_enctrain2_dec_trainneg15_2.pt  -num_epoch 40 -num_block 100000 -batch_size 1000 -channel fading
'''


# atn
# benchmarks
snrs =   [-1.5, -1.0, -0.5, 0.0, 0.5, 1.0, 1.5, 2.0]
turbo_atn_v3_awgndec_ber  = [0.020477, 0.013664, 0.009777, 0.007183, 0.005807, 0.004106, 0.003304, 0.002552]

ntd_bl100_atn_v3_adapt_ber = [0.009775999002158642, 0.005022999830543995, 0.0026990005280822515, 0.0015460002468898892,
                              0.0008110000587999821, 0.0004420000792481005, 0.000245999894104898, 0.00013099999341648072]

turbofy_bl100_atn_v3_adapt_ber = [0.0033720002975314856, 0.00124520028475672, 0.00047400029143318534, 0.00019680021796375513,
                                 9.860002369852737e-05, 4.699998705997132e-05, 2.6599994842195883e-05, 1.3199996722803917e-05]






dta_q2_atn_enctrain2_dectrain_neg15_2_ber =   [0.002069319598376751, 0.0006864801398478448, 0.00026220001745969057, 0.00011157998233102262,
                                               5.56400373170618e-05, 2.784002026601229e-05, 1.2800018339476082e-05, 6.5200033532164525e-06,
                                               3.359998800078756e-06, 1.560000214340107e-06, 6.59999898289243e-07, 4.400000932491821e-07]

dta_q2_atn_enctrain2_dectrain_neg15_2_bler = [0.07207800000000002, 0.03429599999999998, 0.01626999999999999, 0.007919999999999986, 0.00415999999999999, 0.00212, 0.0009920000000000007, 0.0005260000000000003, 0.00027200000000000016, 0.00012200000000000007, 6.0000000000000035e-05, 3.6000000000000014e-05]


dta_cont_atn_enctrain2_dectrain_neg15_2_ber = [0.0018894205568358302, 0.0006292202742770314, 0.00022239997633732855, 9.039998985826969e-05, 4.220000118948519e-05, 1.8960005036205985e-05, 9.540002793073654e-06, 4.499998340179445e-06, 2.559999302320648e-06, 9.599998520570807e-07, 4.2000004896181053e-07, 2.200000039920269e-07]
dta_cont_atn_enctrain2_dectrain_neg15_2_bler = [0.06367799999999998, 0.028767999999999995, 0.01300399999999999, 0.006127999999999992, 0.0029859999999999934, 0.001410000000000001, 0.0007220000000000005, 0.0003260000000000002, 0.00019200000000000014, 6.800000000000004e-05, 3.200000000000001e-05, 1.6e-05]





deepturbo_geawgn = [0.052478592842817307, 0.026815198361873627, 0.011546002700924873, 0.004046800546348095, 0.0012471999507397413, 0.000340400030836463, 0.00010139998630620539, 3.0199993489077315e-05, 1.2999998943996616e-05, 3.400000196052133e-06, 3.9999997625272954e-07, 5.999999643790943e-07]

turbo757_ge_awgn_snr =  [-1.5, -1.0, -0.5, 0.0, 0.5, 1.0, 1.5, 2.0]
turbo757_ge_awgn_ber = [0.163, 0.120919, 0.076027, 0.039762, 0.015186, 0.004697, 0.001143, 0.000375]
turbo757_ge_awgn_bler = [0.9685, 0.8674999999999999, 0.6720999999999999, 0.4265, 0.2027, 0.08040000000000003, 0.02749999999999997, 0.012199999999999989]

dta_cont_geawgn_trained_ge_awgn_ber = [0.03834819421172142, 0.013421999290585518, 0.0037079998292028904, 0.0008731998386792839,
                                           0.000269699958153069, 9.900004079099745e-05, 3.680001100292429e-05, 9.99999883788405e-06]

dta_2quant_geawgn_trained_ge_awgn_ber =  [0.03272319585084915, 0.014719194732606411, 0.0063557978719472885, 0.0026169996708631516,
                                          0.0012316000647842884, 0.000552999961655587, 0.0002929999609477818, 0.00013180002861190587]



turbo757_bl1000_i6_ber = [0.02843181, 0.00209208, 0.00010128, 2.224e-05,
                       7.15e-06, 2.52e-06, 1.03e-06, 3.6e-07]
tae_awgn_bl100_trained =  [0.06782092154026031, 0.011730937287211418, 0.0016839797608554363, 0.0004519498615991324,
                           0.00015781000547576696, 5.535000309464522e-05, 1.909998718474526e-05, 5.929997314524371e-06,
                           1.7699990166875068e-06, 5.400001441557833e-07, 7.999999951380232e-08, 9.99999993922529e-09]


dta_cont_cnn2enc_cnn5dec_enctrain0_dectrainneg15_0_ber = [0.045811861753463745, 0.006480833049863577, 0.0013740999856963754, 0.0003905331879854202,
                                                          1.021e-04, 1.873333040857688e-05, 3.3399987185257487e-06, 8.99999645803473e-07]






import matplotlib.pylab as plt

plt.figure(1)
plt.subplot(121)
plt.title('TurboAE-continuous AWGN block length 1000')
plt.yscale('log')
plt.xlabel('SNR')
plt.ylabel('BER')

p1, = plt.plot(snr[:8], turbo757_bl1000_i6_ber,'-x', label = 'Turbo')
p2, = plt.plot(snr[:8], tae_awgn_bl100_trained[:8], '-.', label = 'TurboAE trained on length 100')
p3, = plt.plot(snr[:8], dta_cont_cnn2enc_cnn5dec_enctrain0_dectrainneg15_0_ber, '->', label = 'TurboAE finetuned on length 1000')

plt.legend(handles =[p1,  p2, p3])


plt.grid()

plt.subplot(122)
plt.title('Normalized Rayleigh Fading Channel')
plt.yscale('log')
plt.xlabel('SNR')
plt.ylabel('BER')


p1, = plt.plot(snr, dta_binary_awgntrained_cnn2cnn5_ber, '-.', label = 'TurboAE-binary ')
p2, = plt.plot(snr, dta_cont_awgntrained_cnn2cnn5_ber, '-o', label = 'TurboAE-continuous')

p3, = plt.plot(snr, turbo757_awgn_rayleigh_fading_ber,'-x', label = 'Turbo')
p4, = plt.plot(snr, tbc,'-+', label = 'TBCC')
p5, = plt.plot(snr, ldpc,'-<', label = 'LDPC')

plt.legend(handles =[p1, p2, p3, p4, p5])
plt.grid()



plt.figure(5)
plt.subplot(121)

plt.title('Additive T-distribution Noise Channel')
plt.yscale('log')
plt.xlabel('SNR')
plt.ylabel('BER')


h1,  = plt.plot(snrs, dta_q2_atn_enctrain2_dectrain_neg15_2_ber[:8],'-.', label = 'TurboAE-binary')
h2,  = plt.plot(snrs, dta_cont_atn_enctrain2_dectrain_neg15_2_ber[:8],'-o', label = 'TurboAE-continuous')

p0,  = plt.plot(snrs, turbo_atn_v3_awgndec_ber,'-x', label = 'Turbo')
p1,  = plt.plot(snrs, turbofy_bl100_atn_v3_adapt_ber,'-+', label = 'DeepTurbo')

plt.legend(handles = [h1,h2,p0, p1])
plt.grid()

plt.subplot(122)
plt.xlabel('SNR')
plt.ylabel('BER')
plt.yscale('log')
plt.title('Non-iid Markovian AWGN Channel')


h1, = plt.plot(turbo757_ge_awgn_snr,dta_2quant_geawgn_trained_ge_awgn_ber, '-.',label = 'TurboAE-binary')
h2, = plt.plot(turbo757_ge_awgn_snr,dta_cont_geawgn_trained_ge_awgn_ber, '-o',label = 'TurboAE-continuous')

p0, = plt.plot(turbo757_ge_awgn_snr,turbo757_ge_awgn_ber, '-x', label = 'Turbo')
p1, = plt.plot(turbo757_ge_awgn_snr,deepturbo_geawgn[:8], '-+', label = 'DeepTurbo')


plt.legend(handles = [h1,h2,p0, p1])


plt.grid()




plt.show()
